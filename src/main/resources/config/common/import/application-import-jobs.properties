# ============================================
# IMPORT JOBS (fila no banco + scheduler + executor)
# ============================================

# Controle de execução de jobs (pode ser sobrescrito por profile)
# true: jobs serão processados automaticamente pelo scheduler
# false: jobs serão criados mas não processados (útil para desenvolvimento local)
import.job.enabled=true

# Máximo 3 jobs simultâneos (pool JOB tem 4 conexões, reserva 1 para operações internas)
import.job.max-concurrent-global=2
import.job.max-concurrent-per-tenant=1
import.job.scheduler-interval-seconds=1800
import.job.scheduler-rapido-interval-seconds=120
import.job.heartbeat-timeout-seconds=300

import.job.priority.sia-pa=100
import.job.priority.sigtap=50
import.job.priority.cid10=10

# Batch size (por tipo) - hot-path JDBC
# Clamp aplicado no código: min=100, max=5000
# OTIMIZAÇÃO 2026-01-18: Reduzido batch size de sia-pa para evitar locks longos
import.job.batch-size=3000
import.job.batch-size.sia-pa=500
import.job.batch-size.sigtap=3000
import.job.batch-size.cid10=3000

# Log de progresso (por tempo). Evita log a cada N batches em jobs longos.
import.job.progress-log-interval-seconds=15

import.job.storage.bucket=imports

# Executor alinhado ao DB e ao controle de concorrência global
import.job.executor.core-pool-size=${import.job.max-concurrent-global:1}
import.job.executor.max-pool-size=${import.job.max-concurrent-global:1}
import.job.executor.queue-capacity=10
import.job.executor.await-termination-seconds=60

import.job.retry-backoff-base-seconds=60

# Retry budget: garante intervalo mínimo entre tentativas (além do backoff exponencial)
import.job.retry-min-interval-seconds=30

# Timeouts transacionais por batch (TransactionTemplate)
# OTIMIZAÇÃO 2026-01-18: Aumentado timeout de sia-pa para acomodar tabela grande
import.job.tx.timeout-seconds.sia-pa=120
import.job.tx.timeout-seconds.cid10=60
import.job.tx.timeout-seconds.sigtap=90

# Upload: limita jobs pendentes por tenant para evitar explosão de fila
# Aumentado para suportar uploads de ZIP que criam múltiplos jobs (SIGTAP, CID-10)
import.job.upload.max-pending-per-tenant=200


