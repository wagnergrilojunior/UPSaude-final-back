# ============================================
# PROD - DATASOURCE (base - credenciais compartilhadas)
# ============================================
# Suporta variáveis de ambiente do Render:
# - SPRING_DATASOURCE_URL (URL completa JDBC) OU
# - DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD (componentes separados)
# Se nenhuma variável estiver configurada, usa valores hardcoded

spring.datasource.driver-class-name=org.postgresql.Driver

# Prioridade: SPRING_DATASOURCE_URL > DB_HOST/DB_PORT/DB_NAME > valores hardcoded
# O Spring Boot lê automaticamente SPRING_DATASOURCE_URL como spring.datasource.url
# Usa pooler do Supabase por padrão (mais resiliente a problemas de DNS)
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://${DB_HOST:aws-1-sa-east-1.pooler.supabase.com}:${DB_PORT:5432}/${DB_NAME:postgres}?sslmode=require&prepareThreshold=0}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:nu3ZmC8pChEm82Xi}

# URLs e credenciais para pools separados (API e JOB)
# Mesma lógica: SPRING_DATASOURCE_URL > componentes individuais > valores hardcoded
# Usa pooler do Supabase por padrão (mais resiliente a problemas de DNS)
spring.datasource.api.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://${DB_HOST:aws-1-sa-east-1.pooler.supabase.com}:${DB_PORT:5432}/${DB_NAME:postgres}?sslmode=require&prepareThreshold=0}
spring.datasource.api.username=${DB_USER:postgres}
spring.datasource.api.password=${DB_PASSWORD:nu3ZmC8pChEm82Xi}
spring.datasource.api.driver-class-name=org.postgresql.Driver

spring.datasource.job.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://${DB_HOST:aws-1-sa-east-1.pooler.supabase.com}:${DB_PORT:5432}/${DB_NAME:postgres}?sslmode=require&prepareThreshold=0}
spring.datasource.job.username=${DB_USER:postgres}
spring.datasource.job.password=${DB_PASSWORD:nu3ZmC8pChEm82Xi}
spring.datasource.job.driver-class-name=org.postgresql.Driver

# Pool de conexões HikariCP (legado - não usado mais, pools estão em api/job separados)
spring.datasource.hikari.leak-detection-threshold=30000
spring.datasource.hikari.pool-name=UpSaudeHikariPool-Prod
spring.datasource.hikari.connection-test-query=SELECT 1

