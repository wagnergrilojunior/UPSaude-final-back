# ============================================
# PROD - REDIS / CACHE
# ============================================

# Configurações do Redis/Upstash para Cache (Produção)
# Migrado para Upstash Redis (cloud managed)
# CORREÇÃO: Migrado para propriedades modernas spring.data.redis.* (Spring Boot 3.x)
# Upstash requer SSL/TLS habilitado (rediss://)
spring.data.redis.host=popular-anteater-8367.upstash.io
spring.data.redis.port=6379
spring.data.redis.password=ASCvAAImcDE2MGM1ZmRmNWE4OGQ0NzllODg1NzQyZmIyNmUzZGFmZXAxODM2Nw
spring.data.redis.ssl.enabled=true
spring.data.redis.timeout=10000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# Configurações para não bloquear startup se Redis não estiver disponível
spring.data.redis.lettuce.shutdown-timeout=10000ms
spring.data.redis.repositories.enabled=false

# Configurações do Cache Manager
spring.cache.redis.time-to-live=300000
spring.cache.redis.key-prefix=upsaude::
spring.cache.type=redis
spring.cache.redis.cache-null-values=false

# ============================================
# Configurações de Métricas do Redis para Observabilidade
# ============================================
# CORREÇÃO: Reativar métricas do Redis/Lettuce após remover pings durante startup
# As métricas agora são coletadas de forma segura sem causar erros 500
# Habilita métricas do Redis (conexões, comandos, latência)
management.metrics.enable.redis=true
# Habilita métricas do cliente Lettuce (pool de conexões, comandos)
management.metrics.enable.lettuce=true
# Habilita métricas do cache Spring (hit/miss, tamanho, evictions)
management.metrics.enable.cache=true
# Habilita métricas do Spring Data Redis (repositories, operações)
management.metrics.enable.spring-data=true
# Tags adicionais para identificação nas métricas
management.metrics.tags.application=upsaude-backend
management.metrics.tags.environment=production
# Distribuição de estatísticas para métricas de latência (histogramas)
management.metrics.distribution.percentiles-histogram.redis.command.execution=false
management.metrics.distribution.percentiles-histogram.lettuce.command=true
management.metrics.distribution.percentiles-histogram.cache.get=true
management.metrics.distribution.percentiles-histogram.cache.put=true
# Percentis específicos para análise de latência (p50, p95, p99)
management.metrics.distribution.percentiles.redis.command.execution=0.5,0.95,0.99
management.metrics.distribution.percentiles.lettuce.command=0.5,0.95,0.99
management.metrics.distribution.percentiles.cache.get=0.5,0.95,0.99
management.metrics.distribution.percentiles.cache.put=0.5,0.95,0.99
# SLOs (Service Level Objectives) para alertas baseados em latência
management.metrics.distribution.slo.redis.command.execution=100ms,500ms,1s
management.metrics.distribution.slo.lettuce.command=100ms,500ms,1s
management.metrics.distribution.slo.cache.get=10ms,50ms,100ms
management.metrics.distribution.slo.cache.put=10ms,50ms,100ms

