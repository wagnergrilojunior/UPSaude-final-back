# ============================================
# CONFIGURAÇÕES PARA DESENVOLVIMENTO LOCAL
# Usa mesmas credenciais do PROD mas sem Redis
# ============================================

# ============================================
# Spring Boot DevTools - HABILITADO apenas em LOCAL
# ============================================
# DevTools ativo para desenvolvimento local (hot reload, restart automático)
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true
# Exclui recursos que não precisam ser monitorados para restart
spring.devtools.restart.exclude=static/**,public/**,templates/**,META-INF/maven/**,META-INF/resources/**

# Configurações do Servidor
server.port=8080
server.servlet.context-path=/api

# Desabilitar Redis e cache para desenvolvimento local
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
spring.cache.type=none

# URL do servidor para Swagger/OpenAPI (local)
springdoc.api-server-url=http://localhost:8080/api

# ============================================
# BANCO DE DADOS - Mesmas credenciais do PROD
# ============================================
spring.datasource.url=jdbc:postgresql://aws-1-sa-east-1.pooler.supabase.com:6543/postgres?sslmode=require&prepareThreshold=0
spring.datasource.username=postgres.pririvdtylilyrtfbmmv
spring.datasource.password=nu3ZmC8pChEm82Xi
spring.datasource.driver-class-name=org.postgresql.Driver

# Pool de conexões otimizado para evitar limite do Supabase
# IMPORTANTE: Configurações agressivas para reduzir conexões ao mínimo e matar conexões lentas/ociosas
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=0
# Idle timeout: conexões ociosas são fechadas após 10 segundos
spring.datasource.hikari.idle-timeout=10000
# Max lifetime: conexões são forçadas a fechar após 60 segundos
spring.datasource.hikari.max-lifetime=60000
# Keepalive: mantém conexões vivas, mas não impede o fechamento por idle-timeout
spring.datasource.hikari.keepalive-time=30000
# Connection timeout: falha rápido se não conseguir conexão
spring.datasource.hikari.connection-timeout=5000
# Validation timeout: valida conexões rapidamente
spring.datasource.hikari.validation-timeout=1000
# Leak detection: detecta vazamentos de conexão em 3 segundos
spring.datasource.hikari.leak-detection-threshold=3000
# Housekeeping period: limpeza do pool a cada 5 segundos (padrão é 30s)
spring.datasource.hikari.housekeeping-period-ms=5000
spring.datasource.hikari.pool-name=UpSaudeHikariPool-Local
# Configurações adicionais para melhor performance e menos conexões
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.initialization-fail-timeout=1
# Desabilita validação de conexão em idle para evitar conexões extras
spring.datasource.hikari.connection-init-sql=
# NOTA: Prepared statements configurados via DataSourceConfig.java e na URL do datasource

# Configuração JPA para desenvolvimento
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.tool.schema.halt_on_error=false
# IMPORTANTE: Desabilitar open-in-view para evitar manter conexões abertas durante requisições
spring.jpa.open-in-view=false
# Configurações para gerenciamento de transações
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
# Configurações de Performance do Hibernate
# Batch fetch size: otimiza lazy loading carregando múltiplos relacionamentos em uma única query
spring.jpa.properties.hibernate.default_batch_fetch_size=25
# JDBC fetch size: otimiza queries paginadas reduzindo round-trips ao banco
spring.jpa.properties.hibernate.jdbc.fetch_size=50
# Configurações para reduzir uso de conexões
spring.jpa.properties.hibernate.connection.handling_mode=delayed_acquisition_and_release_after_transaction

# ============================================
# SUPABASE
# ============================================
supabase.url=https://pririvdtylilyrtfbmmv.supabase.co
supabase.anon-key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByaXJpdmR0eWxpbHlydGZibW12Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NDk3OTYsImV4cCI6MjA3OTMyNTc5Nn0.QFu4AzIltRfXba3gg4u_DBuOf-r55KhoCuwbBuO2ULw
supabase.service-role-key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByaXJpdmR0eWxpbHlydGZibW12Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzc0OTc5NiwiZXhwIjoyMDc5MzI1Nzk2fQ.6VaENvPSOSUTOQ3aRPPre8tGJ8ktme_5CU5hravHdsU

# ============================================
# SWAGGER/OpenAPI
# ============================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# ============================================
# JACKSON
# ============================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# ============================================
# ACTUATOR (simplificado para local)
# ============================================
# Base path do actuator (sem /api)
management.endpoints.web.base-path=/actuator
# Health check principal usa apenas ping (não depende do banco)
management.endpoint.health.group.default.include=ping
management.endpoint.health.group.liveness.include=ping
# Readiness sem banco para evitar conexões durante inicialização
management.endpoint.health.group.readiness.include=ping
management.endpoint.health.show-details=always
management.endpoint.health.timeout=5000ms
# Desabilita health check do banco para evitar conexões extras
management.health.db.enabled=false
management.health.redis.enabled=false
# Desativa métricas JDBC para evitar conexões extras
# NOTA: Todas as outras métricas (HTTP, JVM, Cache, customizadas) continuam funcionando normalmente
management.metrics.jdbc.datasource.enabled=false
# Garante que métricas HTTP, JVM e cache continuem habilitadas
management.metrics.jvm.enabled=true
management.metrics.web.server.auto-time-requests=true
management.metrics.cache.enabled=true
# Exportação de métricas simples (para Actuator)
management.metrics.export.simple.enabled=true

# ============================================
# LOGS (mais verboso para desenvolvimento)
# ============================================
# Logs detalhados para debug local
logging.level.root=INFO
logging.level.com.upsaude=DEBUG
logging.level.org.springframework=INFO
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.com.zaxxer.hikari=INFO

# Configurações de arquivo de log para desenvolvimento
logging.file.name=logs/upsaude-local.log
logging.file.path=logs
logging.file.max-size=5MB
logging.file.max-history=10
logging.file.total-size-cap=50MB
