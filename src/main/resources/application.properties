# Configurações do Servidor
server.port=8080
server.servlet.context-path=/api

# Perfil ativo padrão (pode ser sobrescrito por variável de ambiente SPRING_PROFILES_ACTIVE)
spring.profiles.active=${SPRING_PROFILES_ACTIVE:local}

# DataSource - Configurações básicas (serão sobrescritas pelos profiles)
# As configurações completas estão em application-{profile}.properties
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL:}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}

# Configurações do JPA
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
# Configurações para gerenciamento de transações
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
# Configurações de Performance do Hibernate
# Batch fetch size: otimiza lazy loading carregando múltiplos relacionamentos em uma única query
spring.jpa.properties.hibernate.default_batch_fetch_size=25
# JDBC fetch size: otimiza queries paginadas reduzindo round-trips ao banco
spring.jpa.properties.hibernate.jdbc.fetch_size=50

# Configurações de Segurança
jwt.secret=upsaude-secret-key-2024-muito-segura-e-comprida-para-o-sistema-de-gestao-de-saude
jwt.expiration=86400000

# Configurações de Multi-tenancy
multitenancy.enabled=true
multitenancy.default-schema=public

# Configurações do OpenAPI/Swagger
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# Configurações de Log
logging.level.com.upsaude=INFO
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ============================================
# Configurações de Importação SIGTAP
# ============================================
# Caminho base para arquivos de importação SIGTAP
sigtap.import.base-path=data_import/sigtap
# Tamanho do lote para processamento em batch
sigtap.import.batch-size=500
# Encoding dos arquivos TXT (ISO-8859-1 para caracteres latinos)
sigtap.import.encoding=ISO-8859-1

# ============================================
# Configurações de Importação CID10
# ============================================
# Caminho base para arquivos de importação CID10
cid10.import.base-path=data_import/cid10
# Tamanho do lote para processamento em batch
cid10.import.batch-size=500

# ============================================
# Configurações do Spring Actuator e Observabilidade
# ============================================

# Expõe todos os endpoints do Actuator (health, info, metrics, prometheus, loggers, threaddump, httptrace)
management.endpoints.web.exposure.include=*

# Configurações de Health Check
# Health check mais rápido - não mostra detalhes por padrão para reduzir tempo de resposta
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true
management.health.defaults.enabled=true
management.health.diskspace.enabled=true
management.health.ping.enabled=true
# Health check do banco desabilitado por padrão para evitar conexões extras
# Pode ser habilitado em profiles específicos se necessário
management.health.db.enabled=false
# Redis health check não bloqueia se não estiver disponível
# IMPORTANTE: Redis não é crítico - aplicação funciona sem cache
management.health.redis.enabled=true
management.health.redis.timeout=1000ms
# Health check groups - permite endpoints mais leves
# Liveness: apenas verifica se a aplicação está rodando (ping)
# Readiness: verifica se está pronto para receber tráfego (db apenas)
management.endpoint.health.group.liveness.include=ping
management.endpoint.health.group.readiness.include=db
# Redis não está no readiness para não bloquear startup
# Configura o endpoint padrão /actuator/health para usar apenas ping (mais rápido e confiável)
# Health principal não depende do banco para evitar conexões extras
management.endpoint.health.group.default.include=ping
# Base path do actuator (sem /api)
management.endpoints.web.base-path=/actuator
# Timeout geral do health check endpoint
management.endpoint.health.timeout=2000ms

# Configurações de Info
management.info.env.enabled=true
management.info.build.enabled=true
management.info.git.enabled=true

# Configurações de Métricas
management.metrics.tags.application=UPSaude
management.metrics.tags.environment=${spring.profiles.active:default}

# Coleta métricas detalhadas da JVM
management.metrics.jvm.enabled=true
management.metrics.jvm.memory.enabled=true
management.metrics.jvm.gc.enabled=true
management.metrics.jvm.threads.enabled=true
management.metrics.jvm.classes.enabled=true

# Coleta métricas HTTP detalhadas
management.metrics.web.server.auto-time-requests=true
management.metrics.web.server.request.autotime.enabled=true

# Coleta métricas do DataSource (HikariCP) - DESATIVADO para evitar conexões extras
# IMPORTANTE: Esta desabilita apenas as métricas JDBC específicas do Actuator que criam conexões extras
management.metrics.jdbc.datasource.enabled=false
management.metrics.jdbc.datasource.metric-name=hikari

# Coleta métricas de cache (Redis)
management.metrics.cache.enabled=true

# Configurações de distribuição de métricas
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=100ms,200ms,500ms,1s,2s,5s
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.95,0.99

# Configurações de Loggers
management.endpoint.loggers.enabled=true

# Configurações de Thread Dump
management.endpoint.threaddump.enabled=true

# Configurações de HTTP Trace (substituído por HTTP Exchange no Spring Boot 2.2+)
# Para Spring Boot 3.x, use httpexchanges ao invés de httptrace
management.endpoint.httpexchanges.enabled=true
management.httpexchanges.recording.enabled=true

# Configurações de Logfile - Expõe logs da aplicação via Actuator
management.endpoint.logfile.enabled=true
logging.file.name=logs/upsaude.log
logging.file.path=logs
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=300MB
# Padrão de formatação dos logs no arquivo
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
# Padrão de formatação dos logs no console
logging.pattern.console=%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr([%thread]){magenta} %clr(%-5level){blue} %clr(%logger{36}){cyan} - %msg%n

# Informações da Aplicação
info.app.name=UP Saude
info.app.description=Sistema de Gestão de Saúde Pública e Privada
info.app.version=1.0.0
info.app.encoding=UTF-8
info.app.java.version=17

# Configurações do Jackson para suporte a datas Java 17 (java.time.*)
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false


# Configurações do Redis/Valkey para Cache
# Compatível com Redis e Valkey (fork do Redis usado pelo Render)
# As propriedades podem ser sobrescritas por variáveis de ambiente no Render
# CORREÇÃO: Migrado para propriedades modernas spring.data.redis.* (Spring Boot 3.x)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# Configurações do Cache Manager
spring.cache.redis.time-to-live=300000
spring.cache.redis.key-prefix=upsaude::
spring.cache.type=redis
spring.cache.redis.cache-null-values=false

spring.main.allow-circular-references=true

# ============================================
# Flyway (migrações versionadas) - DESABILITADO
# ============================================
# Flyway removido do projeto. Migrations executadas manualmente quando necessário.

# ============================================
# SIGTAP (SOA-SIGTAP DATASUS) - Integração SOAP
# ============================================
# Endpoints base (produção DATASUS)
sigtap.soap.base-url=https://servicos.saude.gov.br/sigtap
sigtap.soap.procedimento-service-path=/ProcedimentoService/v1
sigtap.soap.nivel-agregacao-service-path=/NivelAgregacaoService/v1
sigtap.soap.compatibilidade-service-path=/CompatibilidadeService/v1
sigtap.soap.compatibilidade-possivel-service-path=/CompatibilidadePossivelService/v1

# Credenciais públicas (DATASUS)
sigtap.soap.username=SIGTAP.PUBLICO
sigtap.soap.password=sigtap#2015public

# Timeouts (ms)
sigtap.soap.connect-timeout-ms=10000
sigtap.soap.read-timeout-ms=60000

# Sincronização
# Competência padrão (AAAAMM). Se vazio, o sistema calcula automaticamente (mês anterior).
sigtap.sync.default-competencia=