# Configurações do Servidor
server.port=8080
server.servlet.context-path=/api

spring.datasource.driver-class-name=org.postgresql.Driver

# Configurações do JPA
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
# Configurações para gerenciamento de transações
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false

# Configurações de Segurança
jwt.secret=upsaude-secret-key-2024-muito-segura-e-comprida-para-o-sistema-de-gestao-de-saude
jwt.expiration=86400000

# Configurações de Multi-tenancy
multitenancy.enabled=true
multitenancy.default-schema=public

# Configurações do OpenAPI/Swagger
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# Configurações de Log
logging.level.com.upsaude=INFO
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ============================================
# Configurações do Spring Actuator e Observabilidade
# ============================================

# Expõe todos os endpoints do Actuator (health, info, metrics, prometheus, loggers, threaddump, httptrace)
management.endpoints.web.exposure.include=*

# Configurações de Health Check
# Health check mais rápido - não mostra detalhes por padrão para reduzir tempo de resposta
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true
management.health.defaults.enabled=true
management.health.diskspace.enabled=true
management.health.ping.enabled=true
management.health.db.enabled=true
# Redis health check não bloqueia se não estiver disponível
# IMPORTANTE: Redis não é crítico - aplicação funciona sem cache
management.health.redis.enabled=true
management.health.redis.timeout=1000ms
# Health check groups - permite endpoints mais leves
# Liveness: apenas verifica se a aplicação está rodando (ping)
# Readiness: verifica se está pronto para receber tráfego (db apenas)
management.endpoint.health.group.liveness.include=ping
management.endpoint.health.group.readiness.include=db
# Redis não está no readiness para não bloquear startup
# Configura o endpoint padrão /actuator/health para usar apenas ping (mais rápido e confiável)
management.endpoint.health.group.default.include=ping
# Timeout geral do health check endpoint
management.endpoint.health.timeout=2000ms

# Configurações de Info
management.info.env.enabled=true
management.info.build.enabled=true
management.info.git.enabled=true

# Configurações de Métricas
management.metrics.tags.application=UPSaude
management.metrics.tags.environment=${spring.profiles.active:default}

# Coleta métricas detalhadas da JVM
management.metrics.jvm.enabled=true
management.metrics.jvm.memory.enabled=true
management.metrics.jvm.gc.enabled=true
management.metrics.jvm.threads.enabled=true
management.metrics.jvm.classes.enabled=true

# Coleta métricas HTTP detalhadas
management.metrics.web.server.auto-time-requests=true
management.metrics.web.server.request.autotime.enabled=true

# Coleta métricas do DataSource (HikariCP)
management.metrics.jdbc.datasource.enabled=true
management.metrics.jdbc.datasource.metric-name=hikari

# Coleta métricas de cache (Redis)
management.metrics.cache.enabled=true

# Configurações de distribuição de métricas
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.sla.http.server.requests=100ms,200ms,500ms,1s,2s,5s
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.95,0.99

# Configurações de Loggers
management.endpoint.loggers.enabled=true

# Configurações de Thread Dump
management.endpoint.threaddump.enabled=true

# Configurações de HTTP Trace (substituído por HTTP Exchange no Spring Boot 2.2+)
# Para Spring Boot 3.x, use httpexchanges ao invés de httptrace
management.endpoint.httpexchanges.enabled=true
management.httpexchanges.recording.enabled=true

# Configurações de Logfile - Expõe logs da aplicação via Actuator
management.endpoint.logfile.enabled=true
logging.file.name=logs/upsaude.log
logging.file.path=logs
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=300MB
# Padrão de formatação dos logs no arquivo
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
# Padrão de formatação dos logs no console
logging.pattern.console=%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr([%thread]){magenta} %clr(%-5level){blue} %clr(%logger{36}){cyan} - %msg%n

# Informações da Aplicação
info.app.name=UP Saude
info.app.description=Sistema de Gestão de Saúde Pública e Privada
info.app.version=1.0.0
info.app.encoding=UTF-8
info.app.java.version=17

# Configurações do Jackson para suporte a datas Java 17 (java.time.*)
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false

# Configurações de Seed (Popular banco de dados com dados de teste via scripts SQL)
# Para habilitar o seed, defina app.seed.enabled=true
# ATENÇÃO: O seed será executado automaticamente na inicialização da aplicação quando habilitado
# Os scripts SQL em src/main/resources/db/seed/*.sql serão executados em ordem numérica
app.seed.enabled=false

# Configurações do Redis/Valkey para Cache
# Compatível com Redis e Valkey (fork do Redis usado pelo Render)
# As propriedades podem ser sobrescritas por variáveis de ambiente no Render
spring.redis.host=${REDIS_HOST:localhost}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.database=${REDIS_DATABASE:0}
spring.redis.timeout=2000ms
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0

# Configurações do Cache Manager
spring.cache.redis.time-to-live=300000
spring.cache.redis.key-prefix=upsaude::
spring.cache.type=redis
spring.cache.redis.cache-null-values=false

# ============================================
# Configurações do Spring Boot Admin
# ============================================
# Nome da aplicação no Spring Boot Admin (global)
spring.boot.admin.client.instance.name=UPSaude Backend
# Metadados adicionais (global)
spring.boot.admin.client.instance.metadata.tags.environment=${spring.profiles.active:default}
spring.boot.admin.client.instance.metadata.tags.version=1.0.0
# Credenciais para autenticação (global, pode ser sobrescrito por variáveis de ambiente)
spring.boot.admin.client.username=${SPRING_BOOT_ADMIN_USER:admin}
spring.boot.admin.client.password=${SPRING_BOOT_ADMIN_PASSWORD:UPSaudeAdmin2025Prod}
# Habilita o client explicitamente
spring.boot.admin.client.enabled=true
# Período de registro (10 segundos)
spring.boot.admin.client.period=10000
# Timeout de conexão
spring.boot.admin.client.connect-timeout=5000
spring.boot.admin.client.read-timeout=5000


spring.main.allow-circular-references=true